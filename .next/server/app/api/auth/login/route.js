(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={28303:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=28303,e.exports=t},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},41204:e=>{"use strict";e.exports=require("string_decoder")},66136:e=>{"use strict";e.exports=require("timers")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},44632:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>T,routeModule:()=>k,serverHooks:()=>_,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>E});var s={};r.r(s),r.d(s,{POST:()=>P});var i=r(42706),a=r(28203),o=r(45994),n=r(39187),c=r(28981),d=r(8848),u=r(73127),l=r(87427);let p=async(e,t,r)=>{let s=await (0,l.A)(e,t,"sign");return(0,u.A)(e,s),new Uint8Array(await crypto.subtle.sign((0,d.A)(e,s.algorithm),s,r))};var h=r(5097),m=r(3014),w=r(68510),g=r(46667),y=r(51571),x=r(22421);class f{#e;#t;#r;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#e=e}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setUnprotectedHeader(e){if(this.#r)throw TypeError("setUnprotectedHeader can only be called once");return this.#r=e,this}async sign(e,t){let r;if(!this.#t&&!this.#r)throw new m.Ye("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,h.A)(this.#t,this.#r))throw new m.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...this.#t,...this.#r},i=(0,y.A)(m.Ye,new Map([["b64",!0]]),t?.crit,this.#t,s),a=!0;if(i.has("b64")&&"boolean"!=typeof(a=this.#t.b64))throw new m.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:o}=s;if("string"!=typeof o||!o)throw new m.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,g.A)(o,e,"sign");let n=this.#e;a&&(n=w.Rd.encode((0,c.l)(n))),r=this.#t?w.Rd.encode((0,c.l)(JSON.stringify(this.#t))):w.Rd.encode("");let d=(0,w.xW)(r,w.Rd.encode("."),n),u=await (0,x.A)(e,o),l=await p(o,u,d),f={signature:(0,c.l)(l),payload:""};return a&&(f.payload=w.D0.decode(n)),this.#r&&(f.header=this.#r),this.#t&&(f.protected=w.D0.decode(r)),f}}class H{#s;constructor(e){this.#s=new f(e)}setProtectedHeader(e){return this.#s.setProtectedHeader(e),this}async sign(e,t){let r=await this.#s.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}var b=r(39466);class j{#t;#i;constructor(e={}){this.#i=new b.c(e)}setIssuer(e){return this.#i.iss=e,this}setSubject(e){return this.#i.sub=e,this}setAudience(e){return this.#i.aud=e,this}setJti(e){return this.#i.jti=e,this}setNotBefore(e){return this.#i.nbf=e,this}setExpirationTime(e){return this.#i.exp=e,this}setIssuedAt(e){return this.#i.iat=e,this}setProtectedHeader(e){return this.#t=e,this}async sign(e,t){let r=new H(this.#i.data());if(r.setProtectedHeader(this.#t),Array.isArray(this.#t?.crit)&&this.#t.crit.includes("b64")&&!1===this.#t.b64)throw new m.Dp("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}var A=r(19637),v=r(58964);async function P(e){try{let{email:t,password:r}=await e.json();if(!t||!r)return n.NextResponse.json({success:!1,message:"Email dan password harus diisi"},{status:400});if("admin@phc.com"===t&&"admin123"===r){let e={id:"admin-001",name:"Administrator",email:"admin@phc.com",role:"ADMIN",clinic_id:null,clinic:null},t=await new j({userId:e.id,id:e.id,name:e.name,email:e.email,role:e.role,clinic_id:null}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1d").sign(new TextEncoder().encode("your-secure-jwt-secret-key-here")),r=n.NextResponse.json({success:!0,message:"Login berhasil",user:e},{status:200}),s={httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400,path:"/"};return r.cookies.set("token",t,s),r.cookies.set("lastActivity",Date.now().toString(),s),r}try{let[e]=await (0,A.P)(`SELECT u.id, u.name, u.email, u.password, u.role, u.is_active, u.clinic_id, 
          c.name as clinic_name, c.code as clinic_code 
        FROM users u 
        LEFT JOIN clinics c ON u.clinic_id = c.id 
        WHERE u.email = ?`,[t]);if(!e)return n.NextResponse.json({success:!1,message:"Email atau password salah"},{status:401});if(!e.is_active)return n.NextResponse.json({success:!1,message:"Akun anda tidak aktif. Silahkan hubungi administrator."},{status:401});if(!await v.compare(r,e.password))return n.NextResponse.json({success:!1,message:"Email atau password salah"},{status:401});let s=await new j({userId:e.id,id:e.id,name:e.name,email:e.email,role:e.role.toUpperCase(),clinic_id:e.clinic_id}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1d").sign(new TextEncoder().encode("your-secure-jwt-secret-key-here")),i={id:e.id,name:e.name,email:e.email,role:e.role.toUpperCase(),clinic_id:e.clinic_id,clinic:e.clinic_id?{id:e.clinic_id,name:e.clinic_name,code:e.clinic_code}:null},a=n.NextResponse.json({success:!0,message:"Login berhasil",user:i},{status:200}),o={httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400,path:"/"};return a.cookies.set("token",s,o),a.cookies.set("lastActivity",Date.now().toString(),o),a}catch(e){if("admin@phc.com"===t&&"admin123"===r)return n.NextResponse.json({success:!1,message:"Database error. Only hardcoded admin login available."},{status:500});return n.NextResponse.json({success:!1,message:"Database error: "+(e.message||"Unknown error")},{status:500})}}catch(e){return console.error("Login error:",e),n.NextResponse.json({error:"Authentication failed"},{status:401})}}let k=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Volumes/Data-2/PHC/Project/dash-app/app/api/auth/login/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:q,workUnitAsyncStorage:E,serverHooks:_}=k;function T(){return(0,o.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:E})}},96487:()=>{},78335:()=>{},19637:(e,t,r)=>{"use strict";r.d(t,{P:()=>p,XA:()=>l});var s=r(60820),i=r(95482),a=r(79551),o=r(33873);let n=(0,a.fileURLToPath)("file:///Volumes/Data-2/PHC/Project/dash-app/lib/db.js"),c=(0,o.dirname)(n),d=(0,o.resolve)(c,"..");i.config({path:(0,o.resolve)(d,".env")}),console.log("Database configuration:",{host:"localhost",user:"root",database:"phc_dashboard"});let u=s.createPool({host:"localhost",user:"root",password:"pr1k1t1w",database:"phc_dashboard",waitForConnections:!0,connectionLimit:10,queueLimit:0,debug:!1,connectTimeout:1e4,typeCast:function(e,t){return"TINY"===e.type&&1===e.length?"1"===e.string():t()}});async function l(){try{return await u.getConnection()}catch(e){throw console.error("Error getting DB connection:",e),Error("Database connection failed")}}async function p(e,t=[]){try{let r=t.map(e=>"number"==typeof e?Number(e):e);console.log("Executing SQL with params:",{sql:e,formattedParams:r});let[s]=await u.execute(e,r);return s}catch(e){throw console.error("Database query error:",e),e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[5994,5452,6673,8964,3303],()=>r(44632));module.exports=s})();