(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={28303:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=28303,e.exports=t},5486:e=>{"use strict";e.exports=require("bcrypt")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},41204:e=>{"use strict";e.exports=require("string_decoder")},66136:e=>{"use strict";e.exports=require("timers")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},41827:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>R,routeModule:()=>k,serverHooks:()=>S,workAsyncStorage:()=>D,workUnitAsyncStorage:()=>N});var s={};r.r(s),r.d(s,{POST:()=>q});var a=r(42706),i=r(28203),o=r(45994),n=r(39187),d=r(13440),c=r(8848),u=r(73127),l=r(87427);let p=async(e,t,r)=>{let s=await (0,l.A)(e,t,"sign");return(0,u.A)(e,s),new Uint8Array(await crypto.subtle.sign((0,c.A)(e,s.algorithm),s,r))};var h=r(5097),y=r(3014),m=r(68510),_=r(46667),g=r(51571),f=r(22421);class w{_payload;_protectedHeader;_unprotectedHeader;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new y.Ye("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,h.A)(this._protectedHeader,this._unprotectedHeader))throw new y.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...this._protectedHeader,...this._unprotectedHeader},a=(0,g.A)(y.Ye,new Map([["b64",!0]]),t?.crit,this._protectedHeader,s),i=!0;if(a.has("b64")&&"boolean"!=typeof(i=this._protectedHeader.b64))throw new y.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:o}=s;if("string"!=typeof o||!o)throw new y.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,_.A)(o,e,"sign");let n=this._payload;i&&(n=m.Rd.encode((0,d.lF)(n))),r=this._protectedHeader?m.Rd.encode((0,d.lF)(JSON.stringify(this._protectedHeader))):m.Rd.encode("");let c=(0,m.xW)(r,m.Rd.encode("."),n),u=await (0,f.A)(e,o),l=await p(o,u,c),w={signature:(0,d.lF)(l),payload:""};return i&&(w.payload=m.D0.decode(n)),this._unprotectedHeader&&(w.header=this._unprotectedHeader),this._protectedHeader&&(w.protected=m.D0.decode(r)),w}}class x{_flattened;constructor(e){this._flattened=new w(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}var b=r(51625),H=r(33802),A=r(78312);function v(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}class E{_payload;constructor(e={}){if(!(0,H.A)(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:v("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:v("setNotBefore",(0,b.A)(e))}:this._payload={...this._payload,nbf:(0,b.A)(new Date)+(0,A.A)(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:v("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:v("setExpirationTime",(0,b.A)(e))}:this._payload={...this._payload,exp:(0,b.A)(new Date)+(0,A.A)(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:(0,b.A)(new Date)}:e instanceof Date?this._payload={...this._payload,iat:v("setIssuedAt",(0,b.A)(e))}:"string"==typeof e?this._payload={...this._payload,iat:v("setIssuedAt",(0,b.A)(new Date)+(0,A.A)(e))}:this._payload={...this._payload,iat:v("setIssuedAt",e)},this}}class P extends E{_protectedHeader;setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){let r=new x(m.Rd.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new y.Dp("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}var T=r(19637),j=r(5486);async function q(e){try{let{email:t,password:r}=await e.json();if(!t||!r)return n.NextResponse.json({success:!1,message:"Email dan password harus diisi"},{status:400});if("admin@phc.com"===t&&"admin123"===r){let e={id:"admin-001",name:"Administrator",email:"admin@phc.com",role:"ADMIN",clinic_id:null,clinic:null},t=await new P({userId:e.id,id:e.id,name:e.name,email:e.email,role:e.role,clinic_id:null}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1d").sign(new TextEncoder().encode("your-secure-jwt-secret-key-here")),r=n.NextResponse.json({success:!0,message:"Login berhasil",user:e},{status:200}),s={httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400,path:"/"};return r.cookies.set("token",t,s),r.cookies.set("lastActivity",Date.now().toString(),s),r}try{let[e]=await (0,T.P)(`SELECT u.id, u.name, u.email, u.password, u.role, u.is_active, u.clinic_id, 
          c.name as clinic_name, c.code as clinic_code 
        FROM users u 
        LEFT JOIN clinics c ON u.clinic_id = c.id 
        WHERE u.email = ?`,[t]);if(!e)return n.NextResponse.json({success:!1,message:"Email atau password salah"},{status:401});if(!e.is_active)return n.NextResponse.json({success:!1,message:"Akun anda tidak aktif. Silahkan hubungi administrator."},{status:401});if(!await j.compare(r,e.password))return n.NextResponse.json({success:!1,message:"Email atau password salah"},{status:401});let s=await new P({userId:e.id,id:e.id,name:e.name,email:e.email,role:e.role.toUpperCase(),clinic_id:e.clinic_id}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1d").sign(new TextEncoder().encode("your-secure-jwt-secret-key-here")),a={id:e.id,name:e.name,email:e.email,role:e.role.toUpperCase(),clinic_id:e.clinic_id,clinic:e.clinic_id?{id:e.clinic_id,name:e.clinic_name,code:e.clinic_code}:null},i=n.NextResponse.json({success:!0,message:"Login berhasil",user:a},{status:200}),o={httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400,path:"/"};return i.cookies.set("token",s,o),i.cookies.set("lastActivity",Date.now().toString(),o),i}catch(e){if("admin@phc.com"===t&&"admin123"===r)return n.NextResponse.json({success:!1,message:"Database error. Only hardcoded admin login available."},{status:500});return n.NextResponse.json({success:!1,message:"Database error: "+(e.message||"Unknown error")},{status:500})}}catch(e){return console.error("Login error:",e),n.NextResponse.json({error:"Authentication failed"},{status:401})}}let k=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Volumes/Data-2/PHC/Project/dash-app/app/api/auth/login/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:D,workUnitAsyncStorage:N,serverHooks:S}=k;function R(){return(0,o.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:N})}},96487:()=>{},78335:()=>{},19637:(e,t,r)=>{"use strict";r.d(t,{P:()=>p,XA:()=>l});var s=r(60820),a=r(95482),i=r(79551),o=r(33873);let n=(0,i.fileURLToPath)("file:///Volumes/Data-2/PHC/Project/dash-app/lib/db.js"),d=(0,o.dirname)(n),c=(0,o.resolve)(d,"..");a.config({path:(0,o.resolve)(c,".env")}),console.log("Database configuration:",{host:"localhost",user:"root",database:"phc_dashboard"});let u=s.createPool({host:"localhost",user:"root",password:"pr1k1t1w",database:"phc_dashboard",waitForConnections:!0,connectionLimit:10,queueLimit:0,debug:!1,connectTimeout:1e4,typeCast:function(e,t){return"TINY"===e.type&&1===e.length?"1"===e.string():t()}});async function l(){try{return await u.getConnection()}catch(e){throw console.error("Error getting DB connection:",e),Error("Database connection failed")}}async function p(e,t=[]){try{let r=t.map(e=>"number"==typeof e?Number(e):e);console.log("Executing SQL with params:",{sql:e,formattedParams:r});let[s]=await u.execute(e,r);return s}catch(e){throw console.error("Database query error:",e),e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[5994,5452,6673,6413],()=>r(41827));module.exports=s})();