"use strict";(()=>{var e={};e.id=491,e.ids=[491],e.modules={5486:e=>{e.exports=require("bcrypt")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{e.exports=require("buffer")},55511:e=>{e.exports=require("crypto")},94735:e=>{e.exports=require("events")},29021:e=>{e.exports=require("fs")},91645:e=>{e.exports=require("net")},21820:e=>{e.exports=require("os")},33873:e=>{e.exports=require("path")},19771:e=>{e.exports=require("process")},27910:e=>{e.exports=require("stream")},41204:e=>{e.exports=require("string_decoder")},66136:e=>{e.exports=require("timers")},34631:e=>{e.exports=require("tls")},79551:e=>{e.exports=require("url")},28354:e=>{e.exports=require("util")},74075:e=>{e.exports=require("zlib")},99210:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>u,serverHooks:()=>w,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{PUT:()=>c});var i=t(42706),o=t(28203),n=t(45994),s=t(99527),d=t(39187),p=t(2321),l=t(5486);async function c(e){try{let r=e.headers.get("authorization")?.replace("Bearer ","");if(!r)return d.NextResponse.json({error:"Token diperlukan"},{status:401});let t=await (0,p.W3)(r),a=await s.KJ.findUnique({where:{id:t.userId}});if(!a)return d.NextResponse.json({error:"User tidak ditemukan"},{status:404});let{name:i,email:o,currentPassword:n,newPassword:c}=await e.json();if(c){if(!n)return d.NextResponse.json({error:"Password lama diperlukan untuk mengubah password"},{status:400});if(!await l.compare(n,a.password))return d.NextResponse.json({error:"Password lama tidak valid"},{status:400})}let u=c?await l.hash(c,10):void 0,{password:f,...h}=await s.KJ.update({where:{id:t.userId},data:{name:i||a.name,email:o||a.email,...u&&{password:u}}});return d.NextResponse.json({message:"Profil berhasil diperbarui",user:h})}catch(e){return console.error("Error updating profile:",e),d.NextResponse.json({error:"Gagal memperbarui profil"},{status:500})}}let u=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/profile/update/route",pathname:"/api/profile/update",filename:"route",bundlePath:"app/api/profile/update/route"},resolvedPagePath:"/Volumes/Data-2/PHC/Project/dash-app/app/api/profile/update/route.js",nextConfigOutput:"",userland:a}),{workAsyncStorage:f,workUnitAsyncStorage:h,serverHooks:w}=u;function y(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:h})}},2321:(e,r,t)=>{t.d(r,{W3:()=>i});var a=t(40853);async function i(e){if(!e)return null;try{let r=new TextEncoder().encode("your-secure-jwt-secret-key-here"),{payload:t}=await (0,a.V)(e,r);return t}catch(e){return console.error("Token verification failed:",e),null}}},40853:(e,r,t)=>{t.d(r,{V:()=>A});var a=t(13440),i=t(8848),o=t(73127),n=t(87427);let s=async(e,r,t,a)=>{let s=await (0,n.A)(e,r,"verify");(0,o.A)(e,s);let d=(0,i.A)(e,s.algorithm);try{return await crypto.subtle.verify(d,s,t,a)}catch{return!1}};var d=t(3014),p=t(68510),l=t(5097),c=t(33802),u=t(46667),f=t(51571);let h=(e,r)=>{if(void 0!==r&&(!Array.isArray(r)||r.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(r)return new Set(r)};var w=t(22421);async function y(e,r,t){let i,o;if(!(0,c.A)(e))throw new d.Ye("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new d.Ye('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new d.Ye("JWS Protected Header incorrect type");if(void 0===e.payload)throw new d.Ye("JWS Payload missing");if("string"!=typeof e.signature)throw new d.Ye("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,c.A)(e.header))throw new d.Ye("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{let r=(0,a.D4)(e.protected);n=JSON.parse(p.D0.decode(r))}catch{throw new d.Ye("JWS Protected Header is invalid")}if(!(0,l.A)(n,e.header))throw new d.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let y={...n,...e.header},m=(0,f.A)(d.Ye,new Map([["b64",!0]]),t?.crit,n,y),b=!0;if(m.has("b64")&&"boolean"!=typeof(b=n.b64))throw new d.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:v}=y;if("string"!=typeof v||!v)throw new d.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');let x=t&&h("algorithms",t.algorithms);if(x&&!x.has(v))throw new d.Rb('"alg" (Algorithm) Header Parameter value not allowed');if(b){if("string"!=typeof e.payload)throw new d.Ye("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new d.Ye("JWS Payload must be a string or an Uint8Array instance");let g=!1;"function"==typeof r&&(r=await r(n,e),g=!0),(0,u.A)(v,r,"verify");let k=(0,p.xW)(p.Rd.encode(e.protected??""),p.Rd.encode("."),"string"==typeof e.payload?p.Rd.encode(e.payload):e.payload);try{i=(0,a.D4)(e.signature)}catch{throw new d.Ye("Failed to base64url decode the signature")}let A=await (0,w.A)(r,v);if(!await s(v,A,i,k))throw new d.h2;if(b)try{o=(0,a.D4)(e.payload)}catch{throw new d.Ye("Failed to base64url decode the payload")}else o="string"==typeof e.payload?p.Rd.encode(e.payload):e.payload;let S={payload:o};return(void 0!==e.protected&&(S.protectedHeader=n),void 0!==e.header&&(S.unprotectedHeader=e.header),g)?{...S,key:A}:S}async function m(e,r,t){if(e instanceof Uint8Array&&(e=p.D0.decode(e)),"string"!=typeof e)throw new d.Ye("Compact JWS must be a string or Uint8Array");let{0:a,1:i,2:o,length:n}=e.split(".");if(3!==n)throw new d.Ye("Invalid Compact JWS");let s=await y({payload:i,protected:a,signature:o},r,t),l={payload:s.payload,protectedHeader:s.protectedHeader};return"function"==typeof r?{...l,key:s.key}:l}var b=t(51625),v=t(78312);let x=e=>e.toLowerCase().replace(/^application\//,""),g=(e,r)=>"string"==typeof e?r.includes(e):!!Array.isArray(e)&&r.some(Set.prototype.has.bind(new Set(e))),k=(e,r,t={})=>{let a,i;try{a=JSON.parse(p.D0.decode(r))}catch{}if(!(0,c.A)(a))throw new d.Dp("JWT Claims Set must be a top-level JSON object");let{typ:o}=t;if(o&&("string"!=typeof e.typ||x(e.typ)!==x(o)))throw new d.ie('unexpected "typ" JWT header value',a,"typ","check_failed");let{requiredClaims:n=[],issuer:s,subject:l,audience:u,maxTokenAge:f}=t,h=[...n];for(let e of(void 0!==f&&h.push("iat"),void 0!==u&&h.push("aud"),void 0!==l&&h.push("sub"),void 0!==s&&h.push("iss"),new Set(h.reverse())))if(!(e in a))throw new d.ie(`missing required "${e}" claim`,a,e,"missing");if(s&&!(Array.isArray(s)?s:[s]).includes(a.iss))throw new d.ie('unexpected "iss" claim value',a,"iss","check_failed");if(l&&a.sub!==l)throw new d.ie('unexpected "sub" claim value',a,"sub","check_failed");if(u&&!g(a.aud,"string"==typeof u?[u]:u))throw new d.ie('unexpected "aud" claim value',a,"aud","check_failed");switch(typeof t.clockTolerance){case"string":i=(0,v.A)(t.clockTolerance);break;case"number":i=t.clockTolerance;break;case"undefined":i=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:w}=t,y=(0,b.A)(w||new Date);if((void 0!==a.iat||f)&&"number"!=typeof a.iat)throw new d.ie('"iat" claim must be a number',a,"iat","invalid");if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw new d.ie('"nbf" claim must be a number',a,"nbf","invalid");if(a.nbf>y+i)throw new d.ie('"nbf" claim timestamp check failed',a,"nbf","check_failed")}if(void 0!==a.exp){if("number"!=typeof a.exp)throw new d.ie('"exp" claim must be a number',a,"exp","invalid");if(a.exp<=y-i)throw new d.n('"exp" claim timestamp check failed',a,"exp","check_failed")}if(f){let e=y-a.iat;if(e-i>("number"==typeof f?f:(0,v.A)(f)))throw new d.n('"iat" claim timestamp check failed (too far in the past)',a,"iat","check_failed");if(e<0-i)throw new d.ie('"iat" claim timestamp check failed (it should be in the past)',a,"iat","check_failed")}return a};async function A(e,r,t){let a=await m(e,r,t);if(a.protectedHeader.crit?.includes("b64")&&!1===a.protectedHeader.b64)throw new d.Dp("JWTs MUST NOT use unencoded payload");let i={payload:k(a.protectedHeader,a.payload,t),protectedHeader:a.protectedHeader};return"function"==typeof r?{...i,key:a.key}:i}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[5994,5452,6673,6413,6821],()=>t(99210));module.exports=a})();