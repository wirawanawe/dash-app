(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4520],{3714:(e,t,a)=>{Promise.resolve().then(a.bind(a,9456))},6932:(e,t,a)=>{"use strict";a.d(t,{A:()=>l,Providers:()=>c});var o=a(5155),r=a(2115),s=a(6046),i=a(5037);let n=(0,r.createContext)();function l(){return(0,r.useContext)(n)}function c(e){let{children:t}=e,[a,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),u=(0,s.useRouter)(),h=(0,s.usePathname)(),[m,g]=(0,r.useState)(Date.now());(0,r.useEffect)(()=>{f();let e=()=>{g(Date.now())};window.addEventListener("mousemove",e),window.addEventListener("keypress",e),window.addEventListener("click",e),window.addEventListener("scroll",e);let t=setInterval(()=>{Date.now()-m>=3e5&&w()},3e4);return()=>{window.removeEventListener("mousemove",e),window.removeEventListener("keypress",e),window.removeEventListener("click",e),window.removeEventListener("scroll",e),clearInterval(t)}},[h,m]);let f=async()=>{try{let e=await fetch("/api/auth/me"),t=await e.json();l(t)}catch(e){console.error("Auth check failed:",e),l(null)}finally{d(!1)}},w=async()=>{try{if(!(await fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok)throw Error("Logout request failed");l(null),i.Ay.error("Sesi Anda telah berakhir. Silakan login kembali."),u.push("/login")}catch(e){console.error("Logout failed:",e),l(null),i.Ay.error("Sesi Anda telah berakhir. Silakan login kembali."),u.push("/login")}},b=async()=>{try{if(!(await fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok)throw Error("Logout request failed");l(null),u.push("/login")}catch(e){console.error("Logout failed:",e),l(null),u.push("/login")}};return c?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-[#E22345]"})}):(0,o.jsxs)(n.Provider,{value:{user:a,setUser:l,logout:b},children:[t,(0,o.jsx)(i.l$,{position:"top-right"})]})}},9456:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var o=a(5155),r=a(2115),s=a(6046),i=a(5037);a(8173),a(5565);var n=a(6932);function l(e){let t="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===t.length?t.pop().split(";").shift():null}function c(){let e=(0,s.useRouter)(),{setUser:t}=(0,n.A)(),[a,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)({email:"",password:""}),[h,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{l("token")&&(console.log("Token found in cookies on page load, redirecting to dashboard"),e.push("/dashboard"))},[e]);let g=async a=>{a.preventDefault(),c(!0),m(null);try{let a;console.log("Login attempt with:",{email:d.email}),"admin@phc.com"===d.email&&"admin123"===d.password&&console.log("Using hardcoded admin credentials");let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),credentials:"include"}),s=await r.text();console.log("Raw response:",s);try{a=JSON.parse(s)}catch(e){throw m({error:"Invalid JSON response",raw:s}),Error("Server returned invalid JSON")}if(!r.ok)throw m({status:r.status,data:a}),Error(a.message||"Login failed");if(!a.success)throw m({status:r.status,data:a,note:"Response was OK but success flag is false"}),Error(a.message||"Login response indicates failure");console.log("Login successful, checking cookies");let n=l("token");if(console.log("Token cookie after login:",n?"Found":"Not found",n?n.substring(0,20)+"...":""),!n){var o;console.log("Token cookie not found, setting it manually");let e=null===(o=r.headers)||void 0===o?void 0:o.get("set-cookie");if(e){console.log("Set-Cookie header found in response");let t=e.match(/token=([^;]+)/);t&&t[1]&&(console.log("Token extracted from header, setting manually"),document.cookie="token=".concat(t[1],"; path=/; max-age=86400"))}}console.log("Fetching user data");let c=await fetch("/api/auth/me",{credentials:"include"});if(!c.ok){let a=await c.text();m({status:c.status,error:"Failed to get user data",raw:a});let o=l("token");if(o){console.log("Trying with explicit Authorization header");let a=await fetch("/api/auth/me",{credentials:"include",headers:{Authorization:"Bearer ".concat(o)}});if(!a.ok)throw Error("Failed to get user data with fallback method");let r=await a.json();if(!r||!r.id)throw Error("Invalid user data received from fallback");t(r),i.Ay.success("Login berhasil"),e.push("/dashboard");return}throw Error("Failed to get user data")}let u=await c.json();if(console.log("User data received:",u),!u||!u.id)throw m({error:"User data is invalid",data:u}),Error("Invalid user data received");t(u),i.Ay.success("Login berhasil"),e.push("/dashboard")}catch(e){console.error("Login error:",e,h),i.Ay.error(e.message||"Login gagal")}finally{c(!1)}},f=async()=>{c(!0),m(null);try{document.cookie="token=".concat("eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiJhZG1pbi0wMDEiLCJpZCI6ImFkbWluLTAwMSIsIm5hbWUiOiJBZG1pbmlzdHJhdG9yIiwiZW1haWwiOiJhZG1pbkBwaGMuY29tIiwicm9sZSI6IkFETUlOIiwiY2xpbmljSWQiOm51bGwsImlhdCI6MTc0NjUxNzI0MiwiZXhwIjoxNzQ2NjAzNjQyfQ.XKIYI-CNPxYsrmQpk_8TB32YnCLbzfgS_8xcwgPHcSs","; path=/; max-age=86400"),t({id:"admin-001",name:"Administrator",email:"admin@phc.com",role:"ADMIN",clinicId:null}),i.Ay.success("Login berhasil (direct method)"),e.push("/dashboard")}catch(e){console.error("Direct login error:",e),i.Ay.error(e.message||"Login gagal")}finally{c(!1)}};return(0,o.jsx)("div",{className:"min-h-screen relative flex items-center justify-center bg-[#FAFAFA]",children:(0,o.jsxs)("div",{className:"relative z-10 bg-[#FAFAFA] p-8 rounded-lg shadow-xl w-full max-w-md",children:[(0,o.jsxs)("h1",{className:"text-2xl font-bold text-center mb-6 text-black",children:["Doctor PHC ",(0,o.jsx)("br",{})," Medical Record"]}),(0,o.jsxs)("form",{onSubmit:g,children:[(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-black mb-2",children:"Email"}),(0,o.jsx)("input",{type:"email",value:d.email,onChange:e=>u({...d,email:e.target.value}),className:"w-full px-3 py-2 border text-black rounded-lg focus:outline-none focus:border-[#E22345]",required:!0})]}),(0,o.jsxs)("div",{className:"mb-6",children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-black mb-2",children:"Password"}),(0,o.jsx)("input",{type:"password",value:d.password,onChange:e=>u({...d,password:e.target.value}),className:"w-full px-3 py-2 border text-black rounded-lg focus:outline-none focus:border-[#E22345]",required:!0})]}),(0,o.jsx)("button",{type:"submit",disabled:a,className:"w-full bg-[#E22345] text-white py-2 rounded-lg hover:bg-red-600 disabled:bg-gray-400",children:a?"Loading...":"Login"}),(0,o.jsxs)("div",{className:"mt-4 text-center flex justify-between",children:[(0,o.jsx)("button",{type:"button",onClick:()=>{u({email:"admin@phc.com",password:"admin123"})},className:"text-sm text-gray-500 hover:text-[#E22345]",children:"Use admin account"}),(0,o.jsx)("button",{type:"button",onClick:f,className:"text-sm text-gray-500 hover:text-[#E22345]",children:"Direct admin login"})]})]}),h&&(0,o.jsxs)("div",{className:"mt-6 p-4 bg-gray-100 rounded text-xs overflow-auto max-h-40",children:[(0,o.jsx)("h3",{className:"font-bold mb-2",children:"Debug Info:"}),(0,o.jsx)("pre",{children:JSON.stringify(h,null,2)})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5037,1028,5565,8441,1517,7358],()=>t(3714)),_N_E=e.O()}]);