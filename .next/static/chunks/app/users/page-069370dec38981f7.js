(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9771],{4559:(e,a,t)=>{Promise.resolve().then(t.bind(t,7436))},7436:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>o});var s=t(5155),l=t(2115),i=t(6046),n=t(5037),r=t(6932),c=t(7006);function d(e){let{user:a,clinics:t,onSubmit:i,onCancel:n}=e,[r,c]=(0,l.useState)({name:"",email:"",password:"",role:"staff",is_active:!0,clinic_id:""}),[d,o]=(0,l.useState)({}),[m,x]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(a){var e,t,s;c({name:a.name||"",email:a.email||"",password:"",role:(null===(e=a.role)||void 0===e?void 0:e.toLowerCase())||"staff",is_active:null===(s=a.is_active)||void 0===s||s,clinic_id:(null===(t=a.clinic)||void 0===t?void 0:t.id)?a.clinic.id.toString():""})}},[a]);let p=e=>{let{name:a,value:t,type:s,checked:l}=e.target;c({...r,[a]:"checkbox"===s?l:t}),d[a]&&o({...d,[a]:null})},u=()=>{let e={};return r.name.trim()||(e.name="Nama harus diisi"),r.email.trim()?/^\S+@\S+\.\S+$/.test(r.email)||(e.email="Format email tidak valid"):e.email="Email harus diisi",a||r.password||(e.password="Password harus diisi"),o(e),0===Object.keys(e).length};return(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-black",children:a?"Edit Pengguna":"Tambah Pengguna Baru"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u()&&i({...r,...a&&!r.password&&{password:void 0},clinic_id:r.clinic_id?parseInt(r.clinic_id):null})},children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap"}),(0,s.jsx)("input",{type:"text",id:"name",name:"name",value:r.name,onChange:p,className:"w-full p-2 text-black border rounded-md ".concat(d.name?"border-red-500":"border-gray-300")}),d.name&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.name})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,s.jsx)("input",{type:"email",id:"email",name:"email",value:r.email,onChange:p,className:"w-full p-2 text-black border rounded-md ".concat(d.email?"border-red-500":"border-gray-300")}),d.email&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.email})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",a&&"(Kosongkan jika tidak ingin mengubah)"]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:m?"text":"password",id:"password",name:"password",value:r.password,onChange:p,className:"w-full p-2 text-black border rounded-md ".concat(d.password?"border-red-500":"border-gray-300")}),(0,s.jsx)("button",{type:"button",className:"absolute right-2 top-2 text-gray-500",onClick:()=>x(!m),children:m?"Hide":"Show"})]}),d.password&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.password})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,s.jsxs)("select",{id:"role",name:"role",value:r.role,onChange:p,className:"w-full p-2 text-black border border-gray-300 rounded-md",children:[(0,s.jsx)("option",{value:"admin",children:"Admin"}),(0,s.jsx)("option",{value:"doctor",children:"Dokter"}),(0,s.jsx)("option",{value:"staff",children:"Staff"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"clinic_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"Klinik"}),(0,s.jsxs)("select",{id:"clinic_id",name:"clinic_id",value:r.clinic_id,onChange:p,className:"w-full p-2 text-black border border-gray-300 rounded-md",children:[(0,s.jsx)("option",{value:"",children:"-- Pilih Klinik --"}),t.map(e=>(0,s.jsxs)("option",{value:e.id.toString(),children:[e.name," (",e.code,")"]},e.id))]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"admin"===r.role?"Admin dapat melihat semua klinik tanpa perlu memilih klinik tertentu":"Staff harus dipilihkan klinik untuk membatasi akses data"})]}),(0,s.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"is_active",name:"is_active",checked:r.is_active,onChange:p,className:"mr-2"}),(0,s.jsx)("label",{htmlFor:"is_active",className:"text-sm font-medium text-gray-700",children:"Aktif"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,s.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400",children:"Batal"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-[#E22345] text-white rounded-md hover:bg-red-600",children:a?"Update":"Simpan"})]})]})]})}function o(){let e=(0,i.useRouter)(),{user:a}=(0,r.A)(),[t,o]=(0,l.useState)([]),[m,x]=(0,l.useState)(!0),[p,u]=(0,l.useState)(""),[h,g]=(0,l.useState)(""),[b,f]=(0,l.useState)({page:1,limit:10,total:0,totalPages:0}),[j,y]=(0,l.useState)(!1),[k,N]=(0,l.useState)(null),[v,w]=(0,l.useState)([]),C=(null==a?void 0:a.role)==="ADMIN";(0,l.useEffect)(()=>{a&&!C&&(n.Ay.error("Hanya admin yang dapat mengakses halaman ini"),e.push("/dashboard"))},[a,C,e]);let S=(0,l.useCallback)(async()=>{try{let e=localStorage.getItem("token"),a=await fetch("/api/settings/clinics",{headers:{Authorization:e?"Bearer ".concat(e):""}});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to fetch clinics")}let t=await a.json();console.log("Clinics fetched successfully:",t.length),w(t)}catch(e){console.error("Error fetching clinics:",e),n.Ay.error("Gagal memuat data klinik")}},[]),E=(0,l.useCallback)(async()=>{try{x(!0);let e=await fetch("/api/users?search=".concat(encodeURIComponent(p),"&page=").concat(b.page,"&limit=").concat(b.limit));if(!e.ok)throw Error("Failed to fetch users");let a=await e.json();o(a.data||[]),f(e=>{var t,s;return{...e,total:(null===(t=a.pagination)||void 0===t?void 0:t.total)||0,totalPages:(null===(s=a.pagination)||void 0===s?void 0:s.totalPages)||1}})}catch(e){console.error("Error fetching users:",e),n.Ay.error("Gagal memuat data pengguna")}finally{x(!1)}},[p,b.page,b.limit]);(0,l.useEffect)(()=>{C&&(E(),S())},[C,E,S]);let _=e=>{f(a=>({...a,page:e}))},P=e=>{N(e),y(!0)},A=async e=>{if(confirm("Anda yakin ingin menghapus pengguna ini?"))try{if(!(await fetch("/api/users/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete user");n.Ay.success("Pengguna berhasil dihapus"),E()}catch(e){console.error("Error deleting user:",e),n.Ay.error("Gagal menghapus pengguna")}},F=async e=>{try{let a=k?"/api/users/".concat(k.id):"/api/users",t=k?"PUT":"POST",s=await fetch(a,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to save user")}n.Ay.success(k?"Pengguna berhasil diperbarui":"Pengguna berhasil ditambahkan"),y(!1),E()}catch(e){console.error("Error saving user:",e),n.Ay.error(e.message||"Gagal menyimpan data pengguna")}};return C?(0,s.jsx)(c.A,{children:(0,s.jsxs)("div",{className:"container mx-auto p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-black",children:"Manajemen Pengguna"}),!j&&(0,s.jsx)("button",{onClick:()=>{N(null),y(!0)},className:"bg-[#E22345] text-white px-4 py-2 rounded-lg hover:bg-red-600",children:"Tambah Pengguna"})]}),j&&(0,s.jsx)(d,{user:k,clinics:v,onSubmit:F,onCancel:()=>y(!1)}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u(h),f(e=>({...e,page:1}))},className:"flex",children:[(0,s.jsx)("input",{type:"text",placeholder:"Cari pengguna...",value:h,onChange:e=>{g(e.target.value)},className:"p-2 border rounded-l-lg w-full text-black"}),(0,s.jsx)("button",{type:"submit",className:"bg-[#E22345] text-white px-4 py-2 rounded-r-lg hover:bg-red-600",children:"Cari"})]})}),m?(0,s.jsx)("div",{className:"text-center py-10",children:"Loading..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-black uppercase",children:"Nama"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-black uppercase",children:"Email"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-black uppercase",children:"Role"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-black uppercase",children:"Klinik"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-black uppercase",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-black uppercase",children:"Aksi"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.length>0?t.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-black",children:e.name}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-black",children:e.email}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-black",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("ADMIN"===e.role?"bg-purple-100 text-purple-800":"DOCTOR"===e.role?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:e.role})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-black",children:e.clinic?e.clinic.name:"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-black",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Aktif":"Tidak Aktif"})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-black",children:[(0,s.jsx)("button",{onClick:()=>P(e),className:"text-blue-600 hover:text-blue-900 mr-4",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>A(e.id),className:"text-red-600 hover:text-red-900",children:"Hapus"})]})]},e.id)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center text-black",children:"Tidak ada data pengguna"})})})]})}),b.totalPages>1&&(0,s.jsx)("div",{className:"flex justify-center mt-6",children:(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>_(1),disabled:1===b.page,className:"px-3 py-1 border rounded disabled:opacity-50",children:"<<"}),(0,s.jsx)("button",{onClick:()=>_(b.page-1),disabled:1===b.page,className:"px-3 py-1 border rounded disabled:opacity-50",children:"<"}),(0,s.jsxs)("span",{className:"px-3 py-1",children:["Halaman ",b.page," dari ",b.totalPages]}),(0,s.jsx)("button",{onClick:()=>_(b.page+1),disabled:b.page===b.totalPages,className:"px-3 py-1 border rounded disabled:opacity-50",children:">"}),(0,s.jsx)("button",{onClick:()=>_(b.totalPages),disabled:b.page===b.totalPages,className:"px-3 py-1 border rounded disabled:opacity-50",children:">>"})]})})]})]})}):null}}},e=>{var a=a=>e(e.s=a);e.O(0,[6711,5037,1028,7316,8441,1517,7358],()=>a(4559)),_N_E=e.O()}]);